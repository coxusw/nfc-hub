<script>
const DEFAULT_THEME = "theme-01-neon-dark.css";
const DEFAULT_LOGO = "/logo.jpg";

const GOOGLE_FORM_PREFILL_URL = ""; // optional
const THEME_QUERY_KEY = "";

const $ = (id)=>document.getElementById(id);

function normalizeUrl(u){
  const x = (u||"").trim();
  if(!x) return "";
  if(x.startsWith("http://") || x.startsWith("https://")) return x;
  return "https://" + x;
}

function getParam(name){
  return new URLSearchParams(location.search).get(name) || "";
}

function applyTheme(themeFile){
  const theme = (themeFile || DEFAULT_THEME).trim();
  $("themeName").textContent = theme;
  const href = `/themes/${theme}`.replace("/themes//","/themes/");
  document.getElementById("themeStylesheet").href = href + `?v=${Date.now()}`;
  return theme;
}

function setLogo(src){
  const img = $("logoImg");
  img.src = src || DEFAULT_LOGO;
  img.onerror = ()=>{ img.onerror=null; img.src = DEFAULT_LOGO; };
}

function main(){
  if (getParam("embed") === "1") document.body.classList.add("embed");
  $("year").textContent = new Date().getFullYear();

  const theme = applyTheme(getParam("theme") || DEFAULT_THEME);

  // ✅ logo override for gallery previews
  const logo = (getParam("logo") || "").trim();
  setLogo(logo || DEFAULT_LOGO);

  const businessName = getParam("businessName") || "Your Business Name";
  const tagline = getParam("tagline") || "";
  const about = getParam("about") || "";

  const website = normalizeUrl(getParam("website"));
  const facebook = normalizeUrl(getParam("facebook"));
  const instagram = normalizeUrl(getParam("instagram"));
  const tiktok = normalizeUrl(getParam("tiktok"));

  const name = getParam("name") || "Your Name";
  const phone = (getParam("phone") || "").trim();
  const email = (getParam("email") || "").trim();

  document.title = `Preview — ${businessName}`;
  $("brand").textContent = businessName;
  $("footerBrand").textContent = businessName;
  $("tagline").textContent = tagline;
  $("about").textContent = about;

  $("btnWebsite").href = website || "#";
  $("btnFacebook").href = facebook || "#";
  $("btnTikTok").href = tiktok || "#";
  $("logoLink").href = website || "#";

  $("contactName").textContent = name;
  $("contactPhone").href = phone ? `tel:${phone}` : "#";
  $("contactPhone").textContent = phone || "";
  $("contactEmail").href = email ? `mailto:${email}` : "#";
  $("contactEmail").textContent = email || "";

  $("pillCall").href = phone ? `tel:${phone}` : "#";
  $("pillText").href = phone ? `sms:${phone}` : "#";
  $("pillEmail").href = email ? `mailto:${email}` : "#";

  $("btnVcard").href = "#";
  $("btnVcard").addEventListener("click", (e)=>{
    e.preventDefault();
    alert("This is only a preview. vCard will work on the final card.");
  });

  $("btnCopy").addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText(theme);
      $("btnCopy").textContent = "Copied!";
      setTimeout(()=>$("btnCopy").textContent="Copy theme name", 1200);
    }catch{
      alert("Theme: " + theme);
    }
  });

  if(GOOGLE_FORM_PREFILL_URL && GOOGLE_FORM_PREFILL_URL.trim() !== ""){
    const u = new URL(GOOGLE_FORM_PREFILL_URL);
    u.searchParams.set(THEME_QUERY_KEY, theme);
    $("btnForm").href = u.toString();
    $("btnForm").style.display = "";
  }
}

main();
</script>