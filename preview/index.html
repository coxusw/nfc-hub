<!doctype html>
<!-- =========================================================
  TAP-DECK — Theme Preview (iframe + full preview)
  File: /preview/index.html

  Supports:
  - ?theme=animated-ember-flicker.css
  - ?embed=1  (hides extra UI for thumbnails)
  - ?logo=/assets/logos/crestedcritters.png  (override default logo)
  - Sample content params for thumbnails:
      businessName, tagline, about, website, facebook, instagram, tiktok,
      name, phone, email
========================================================= -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Preview</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Base styles used by all themes -->
  <link rel="stylesheet" href="/base.css" />
  <!-- Theme is swapped dynamically -->
  <link id="themeStylesheet" rel="stylesheet" href="/themes/theme-01-neon-dark.css" />

  <style>
    /* Preview-only chrome (kept minimal) */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      max-width:980px;
      margin:12px auto 0;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.85);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    }
    .topbar .left{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08);
      font-weight:800;
      font-size:12px;
    }
    .btn-mini{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.10);
      color:rgba(255,255,255,.92);
      font-weight:900;
      cursor:pointer;
    }
    .btn-mini:active{transform:translateY(1px)}
    body.embed .topbar{display:none !important;}
  </style>
</head>

<body>
  <!-- Preview chrome -->
  <div class="topbar">
    <div class="left">
      <span class="pill">Preview</span>
      <span class="pill" id="themeName">theme-01-neon-dark.css</span>
    </div>
    <div class="right">
      <button class="btn-mini" id="btnCopy" type="button">Copy theme name</button>
      <a class="btn-mini" id="btnForm" href="#" style="display:none; text-decoration:none;" target="_blank" rel="noopener">Open intake form</a>
    </div>
  </div>

  <!-- Card -->
  <main class="wrap">
    <section class="card">

      <header class="hero">
        <a class="logo-link" id="logoLink" href="#" target="_blank" rel="noopener">
          <img class="logo" id="logoImg" src="/assets/logos/crestedcritters.png" alt="Logo" />
        </a>

        <div class="titleblock">
          <h1 class="brand" id="brand">Your Business Name</h1>
          <p class="tagline" id="tagline"></p>
        </div>
      </header>

      <nav class="links" aria-label="Primary links">
        <a class="btn" id="btnWebsite" href="#" target="_blank" rel="noopener">Website</a>
        <a class="btn" id="btnFacebook" href="#" target="_blank" rel="noopener">Facebook</a>
        <a class="btn" id="btnInstagram" href="#" target="_blank" rel="noopener">Instagram</a>
        <a class="btn" id="btnTikTok" href="#" target="_blank" rel="noopener">TikTok</a>
        <a class="btn vcard" id="btnVcard" href="#" download>Save Contact</a>
      </nav>

      <section class="section">
        <h2>About</h2>
        <p id="about"></p>
      </section>

      <section class="section">
        <h2>Contact info</h2>

        <div class="contact-grid">
          <div class="contact-item">
            <div class="label">Name</div>
            <div class="value" id="contactName"></div>
          </div>

          <div class="contact-item">
            <div class="label">Phone</div>
            <div class="value"><a id="contactPhone" href="#"></a></div>
          </div>

          <div class="contact-item">
            <div class="label">Email</div>
            <div class="value"><a id="contactEmail" href="#"></a></div>
          </div>
        </div>

        <div class="quick-actions" aria-label="Quick actions">
          <a class="pill" id="pillCall" href="#">Call</a>
          <a class="pill" id="pillText" href="#">Text</a>
          <a class="pill" id="pillEmail" href="#">Email</a>
        </div>
      </section>

      <footer class="footer">
        <span>© <span id="year"></span> <span id="footerBrand"></span></span>
      </footer>

    </section>
  </main>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const DEFAULT_THEME = "theme-01-neon-dark.css";
  const DEFAULT_LOGO  = "/assets/logos/crestedcritters.png";

  // Optional: if you later want a "Open intake form" button on preview
  const GOOGLE_FORM_PREFILL_URL = ""; // leave blank unless you want it
  const THEME_QUERY_KEY = "";         // e.g. entry.2114451287

  const $ = (id) => document.getElementById(id);

  function normalizeUrl(u){
    const x = (u || "").trim();
    if (!x) return "";
    if (x.startsWith("http://") || x.startsWith("https://")) return x;
    return "https://" + x;
  }

  function getParam(name){
    return new URLSearchParams(location.search).get(name) || "";
  }

  function applyTheme(themeFile){
    const theme = (themeFile || DEFAULT_THEME).trim();
    $("themeName").textContent = theme;

    const href = `/themes/${theme}`.replace("/themes//", "/themes/");
    document.getElementById("themeStylesheet").href = href + `?v=${Date.now()}`;
    return theme;
  }

  function setLogo(src){
    const img = $("logoImg");
    img.src = src || DEFAULT_LOGO;
    img.onerror = () => { img.onerror = null; img.src = DEFAULT_LOGO; };
  }

  function main(){
    if (getParam("embed") === "1") document.body.classList.add("embed");
    $("year").textContent = new Date().getFullYear();

    const theme = applyTheme(getParam("theme") || DEFAULT_THEME);

    // Logo override for gallery previews
    const logo = (getParam("logo") || "").trim();
    setLogo(logo || DEFAULT_LOGO);

    const businessName = getParam("businessName") || "Crested Critters";
    const tagline      = getParam("tagline") || "";
    const about        = getParam("about") || "";

    const website   = normalizeUrl(getParam("website"));
    const facebook  = normalizeUrl(getParam("facebook"));
    const instagram = normalizeUrl(getParam("instagram"));
    const tiktok    = normalizeUrl(getParam("tiktok"));

    const name  = getParam("name") || "Your Name";
    const phone = (getParam("phone") || "").trim();
    const email = (getParam("email") || "").trim();

    document.title = `Preview — ${businessName}`;
    $("brand").textContent = businessName;
    $("footerBrand").textContent = businessName;

    $("tagline").textContent = tagline;
    $("about").textContent = about;

    // Buttons
    $("btnWebsite").href   = website || "#";
    $("btnFacebook").href  = facebook || "#";
    $("btnInstagram").href = instagram || "#";
    $("btnTikTok").href    = tiktok || "#";
    $("logoLink").href     = website || "#";

    // Contact
    $("contactName").textContent = name;

    $("contactPhone").href = phone ? `tel:${phone}` : "#";
    $("contactPhone").textContent = phone || "";

    $("contactEmail").href = email ? `mailto:${email}` : "#";
    $("contactEmail").textContent = email || "";

    $("pillCall").href  = phone ? `tel:${phone}` : "#";
    $("pillText").href  = phone ? `sms:${phone}` : "#";
    $("pillEmail").href = email ? `mailto:${email}` : "#";

    // vCard is disabled in preview
    $("btnVcard").href = "#";
    $("btnVcard").addEventListener("click", (e)=>{
      e.preventDefault();
      alert("This is only a preview. vCard will work on the final card.");
    });

    // Copy theme name
    $("btnCopy").addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(theme);
        $("btnCopy").textContent = "Copied!";
        setTimeout(()=> $("btnCopy").textContent = "Copy theme name", 1200);
      } catch {
        alert("Theme: " + theme);
      }
    });

    // Optional: prefill button
    if (GOOGLE_FORM_PREFILL_URL && THEME_QUERY_KEY){
      const u = new URL(GOOGLE_FORM_PREFILL_URL);
      u.searchParams.set(THEME_QUERY_KEY, theme);
      $("btnForm").href = u.toString();
      $("btnForm").style.display = "";
    }
  }

  main();

});
</script>
</body>
</html>