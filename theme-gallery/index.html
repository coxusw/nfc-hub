<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NFC Theme Gallery</title>

<link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>

:root{
  --bg1:#050816;
  --bg2:#0b1020;
  --card:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --text:#eef2ff;
  --muted:#b6c2ff;
}

body{
  margin:0;
  font-family:Inter,system-ui;
  color:var(--text);
  background:
    radial-gradient(circle at 20% 20%, rgba(6,182,212,.18), transparent 45%),
    radial-gradient(circle at 80% 30%, rgba(167,139,250,.14), transparent 45%),
    linear-gradient(180deg,var(--bg1),var(--bg2),var(--bg1));
}

.wrap{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

header{
  text-align:center;
}

h1{
  font-family:Fraunces;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
}

.thumb{
  width:100%;
  height:300px;
  border-radius:12px;
  overflow:hidden;
}

.thumb iframe{
  width:100%;
  height:100%;
  border:none;
}

.btn{
  display:inline-block;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.08);
  color:var(--text);
  text-decoration:none;
  cursor:pointer;
  margin-top:10px;
}

.slug-box{
  text-align:center;
  margin:20px auto;
  max-width:420px;
}

.slug-label{
  display:block;
  margin-bottom:6px;
  font-weight:600;
}

.slug-input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:2px solid #ff4d4d;
  background:#111;
  color:white;
  font-size:16px;
}

.slug-status{
  margin-top:8px;
  font-weight:600;
}

.slug-status.good{
  color:#22c55e;
}

.slug-status.bad{
  color:#ef4444;
}

.slug-help{
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
}

</style>
</head>
<body>

<div class="wrap">

<header>
<h1>Choose your theme</h1>
</header>

<!-- SLUG INPUT -->
<div class="slug-box">

<label class="slug-label">Choose your profile link (required)</label>

<input
id="slugInput"
class="slug-input"
placeholder="example: john-doe"
autocomplete="off"
/>

<div id="slugStatus" class="slug-status"></div>

<div class="slug-help">
Your profile will be:
<code id="slugPreview">https://card.crestedcritters.com/your-slug</code>
</div>

</div>

<div class="grid" id="grid"></div>

</div>

<script>

const BRAND_HOST="card.crestedcritters.com";

const GITHUB_OWNER="coxusw";
const GITHUB_REPO="nfc-hub";
const GITHUB_BRANCH="main";

const $=id=>document.getElementById(id);

let ALL=[];

function slugify(text){
return text
.toLowerCase()
.trim()
.replace(/[^a-z0-9]+/g,"-")
.replace(/^-+|-+$/g,"");
}

async function checkSlug(slug){

if(!slug){
$("slugStatus").textContent="";
return;
}

$("slugPreview").textContent=
`https://${BRAND_HOST}/${slug}`;

try{

const res=await fetch(
`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/data/clients/${slug}.json`
);

if(res.status===404){

$("slugStatus").textContent="✓ Available";
$("slugStatus").className="slug-status good";

}else{

$("slugStatus").textContent="✗ Already taken";
$("slugStatus").className="slug-status bad";

}

}catch{

$("slugStatus").textContent="Error checking slug";
$("slugStatus").className="slug-status bad";

}

}

$("slugInput").addEventListener("input",e=>{

const slug=slugify(e.target.value);

e.target.value=slug;

checkSlug(slug);

});

function previewUrl(theme){

return `https://${BRAND_HOST}/preview/?theme=${theme}&embed=1`;

}

function payUrl(theme){

const slug=$("slugInput").value;

if(!slug){

alert("Enter a slug first");

return;

}

location.href=
`https://${BRAND_HOST}/pay/?theme=${theme}&slug=${slug}`;

}

async function fetchThemes(){

const res=await fetch(
`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/themes?ref=${GITHUB_BRANCH}`
);

const data=await res.json();

return data
.filter(x=>x.name.endsWith(".css"))
.map(x=>x.name);

}

function render(){

const grid=$("grid");

grid.innerHTML="";

ALL.forEach(theme=>{

const card=document.createElement("div");

card.className="card";

card.innerHTML=`

<div>${theme}</div>

<div class="thumb">
<iframe src="${previewUrl(theme)}"></iframe>
</div>

<button class="btn">Use this theme</button>

`;

card.querySelector("button").onclick=
()=>payUrl(theme);

grid.appendChild(card);

});

}

async function init(){

ALL=await fetchThemes();

render();

}

init();

</script>

</body>
</html>