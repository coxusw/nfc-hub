<!doctype html>
<!-- =========================================================
  NFC Hub — Paywall Entry
  File: /pay/index.html

  What it does:
  - Receives ?theme=...&slug=... from "Use this theme"
  - If they have a bypass code, sends them straight to the Google Form
  - Otherwise, sends them to Square payment with a return URL to /pay/paid.html
========================================================= -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Activate Your NFC Profile</title>
  <meta name="description" content="Complete payment to activate your NFC profile, or enter a code." />
  <style>
    :root{
      --bg1:#050816; --bg2:#0b1020;
      --card:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.12);
      --text:#eef2ff; --muted:#b6c2ff;
      --btn:rgba(255,255,255,.10);
      --btnb:rgba(255,255,255,.16);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at 20% 20%, rgba(6,182,212,.18) 0%, transparent 45%),
        radial-gradient(circle at 80% 30%, rgba(167,139,250,.14) 0%, transparent 45%),
        linear-gradient(180deg,var(--bg1),var(--bg2),var(--bg1));
      display:flex; align-items:center; justify-content:center;
      padding:24px 16px;
    }
    .card{
      width:min(560px,100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
    }
    h1{margin:0 0 8px 0; font-size:22px}
    .sub{margin:0 0 14px 0; color:var(--muted); line-height:1.5}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 14px; border-radius:12px;
      border:1px solid var(--btnb);
      background:var(--btn);
      color:var(--text);
      text-decoration:none;
      font-weight:800;
      cursor:pointer;
      flex:1;
      min-width:220px;
    }
    .btn.primary{
      background:linear-gradient(90deg, rgba(34,197,94,.24), rgba(6,182,212,.18));
      border-color:rgba(34,197,94,.28);
    }
    label{display:block; font-weight:700; margin:14px 0 6px}
    input{
      width:100%;
      background:rgba(0,0,0,.22);
      border:1px solid var(--border);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }
    .small{font-size:12px; color:var(--muted); margin-top:8px}
    code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px}
    .notice{
      display:none;
      margin:12px 0 0;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(239,68,68,.25);
      background:rgba(239,68,68,.10);
      color:#ffd1d1;
    }
  </style>
</head>
<body>
  <main class="card">
    <h1>Activate your NFC profile</h1>
    <p class="sub">
      You’re one step away. Complete payment to continue, or enter a free access code if you were given one.
    </p>

    <div class="row" style="margin:10px 0 4px;">
      <a class="btn primary" id="btnPay" href="#">Continue to payment</a>
      <button class="btn" id="btnSkip" type="button">I already paid</button>
    </div>

    <label for="code">Have a free access code?</label>
    <input id="code" placeholder="Enter code (optional)" autocomplete="off" />
    <div class="row" style="margin-top:10px;">
      <button class="btn" id="btnUseCode" type="button">Use code & continue</button>
    </div>

    <div class="small">
      Theme: <code id="dbgTheme"></code> &nbsp; • &nbsp; Slug: <code id="dbgSlug"></code>
    </div>

    <div class="notice" id="notice"></div>
  </main>

<script>
/* =========================================================
   ✅ EDIT HERE (already filled with your values)
========================================================= */
const SQUARE_PAYMENT_LINK = "https://square.link/u/tvd67HVK";

const GOOGLE_FORM_PREFILL_URL = "https://docs.google.com/forms/d/e/1FAIpQLSeS31lPzqUNhcwy3fnXIYOVJPSNgydtd38XF61HHSs_ck72SA/viewform?usp=pp_url";
const THEME_QUERY_KEY = "entry.2114451287";
const SLUG_QUERY_KEY  = "entry.1052989883";

/* Free code support (OPTIONAL)
   - Put your real codes here.
   - Codes are checked client-side only, so don’t use “high security” codes.
   - Good enough for simple promo/comp situations.
*/
const FREE_CODES = [
  "FREE100",
  "CRESTEDVIP",
  "WELCOME"
];

/* ========================================================= */

const $ = (id)=>document.getElementById(id);

function getParam(name){
  return new URLSearchParams(location.search).get(name) || "";
}

function normalizeTheme(t){
  return (t||"").trim().replace(/^\/?themes\//i,"").replace(/^\/+/,"");
}

function normalizeSlug(s){
  return (s||"").trim().toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");
}

function formUrl(theme, slug){
  const u = new URL(GOOGLE_FORM_PREFILL_URL);
  if (theme) u.searchParams.set(THEME_QUERY_KEY, theme);
  if (slug)  u.searchParams.set(SLUG_QUERY_KEY, slug);
  return u.toString();
}

function paidUrl(theme, slug){
  const u = new URL(location.origin + "/pay/paid.html");
  if (theme) u.searchParams.set("theme", theme);
  if (slug)  u.searchParams.set("slug", slug);
  return u.toString();
}

function showNotice(msg){
  const n = $("notice");
  n.textContent = msg;
  n.style.display = msg ? "" : "none";
}

function main(){
  const theme = normalizeTheme(getParam("theme"));
  const slug  = normalizeSlug(getParam("slug"));

  $("dbgTheme").textContent = theme || "(none)";
  $("dbgSlug").textContent  = slug  || "(none)";

  // If you want to REQUIRE slug, uncomment:
  // if(!slug){ showNotice("Missing slug. Go back and choose a theme again."); }

  // Pay button: go to Square with return to our paid.html
  $("btnPay").href = SQUARE_PAYMENT_LINK + "?redirect_url=" + encodeURIComponent(paidUrl(theme, slug));

  // "I already paid" -> go to paid.html
  $("btnSkip").addEventListener("click", ()=>{
    location.href = paidUrl(theme, slug);
  });

  // Code bypass
  $("btnUseCode").addEventListener("click", ()=>{
    const code = ($("code").value || "").trim().toUpperCase();
    if(!code){
      showNotice("Enter a code, or continue to payment.");
      return;
    }
    if(!FREE_CODES.includes(code)){
      showNotice("Code not recognized. Please try again or continue to payment.");
      return;
    }
    // Bypass -> go straight to form
    location.href = formUrl(theme, slug);
  });
}

main();
</script>
</body>
</html>