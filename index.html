<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tap-Deck</title>

  <link rel="stylesheet" href="/base.css?v=2" />
  <link id="themeStylesheet" rel="stylesheet" href="/themes/theme-01-neon-dark.css?v=1" />
</head>

<body>
  <main class="wrap">
    <section class="card">

      <!-- ================= HEADER ================= -->
      <header class="header">
        <a id="logoLink" href="#" target="_blank" rel="noopener" style="text-decoration:none">
          <img id="logoImg" class="logo" alt="Logo" src="/assets/logos/crestedcritters.png" />
        </a>

        <h1 class="brand" id="brand">Loading…</h1>
        <p class="tagline" id="tagline"></p>
      </header>

      <!-- ================= MAIN LINKS ================= -->
      <nav class="links" id="linksWrap">
        <a class="btn btn--grad" id="btnWebsite" href="#" target="_blank">Website</a>
        <a class="btn btn--grad" id="btnFacebook" href="#" target="_blank">Facebook</a>
        <a class="btn btn--grad" id="btnInstagram" href="#" target="_blank">Instagram</a>
        <a class="btn btn--grad" id="btnTikTok" href="#" target="_blank">TikTok</a>
        <a class="btn btn--grad" id="btnLinkedIn" href="#" target="_blank">LinkedIn</a>
        <a class="btn btn--grad" id="btnPayPal" href="#" target="_blank">PayPal</a>
        <a class="btn btn--grad" id="btnCashApp" href="#" target="_blank">Cash App</a>
        <a class="btn btn--grad" id="btnVenmo" href="#" target="_blank">Venmo</a>
        <a class="btn btn--grad" id="btnVcard" href="#" download>Save Contact</a>
      </nav>

      <hr class="sep" />

      <!-- ================= ABOUT ================= -->
      <section id="aboutSection">
        <div class="section-title">About</div>
        <div id="about" class="small"></div>
      </section>

      <!-- ================= ACTION BUTTONS (NEW POSITION) ================= -->
      <div class="actions" id="actionsWrap">
        <div class="actions-inner">
          <a class="action-btn is-hidden" id="btnCall">Call</a>
          <a class="action-btn is-hidden" id="btnText">Text</a>
          <a class="action-btn is-hidden" id="btnEmail">Email</a>
        </div>
      </div>

      <hr class="sep" />

      <!-- ================= CONTACT ================= -->
      <section id="contactSection">
        <div class="section-title">Contact Info</div>
        <div class="contact-grid">
          <div class="contact-row">
            <span class="pill">Name</span>
            <span id="contactName"></span>
          </div>

          <div class="contact-row is-hidden" id="rowPhone">
            <span class="pill">Phone</span>
            <a id="contactPhone" href="#"></a>
          </div>

          <div class="contact-row is-hidden" id="rowEmail">
            <span class="pill">Email</span>
            <a id="contactEmail" href="#"></a>
          </div>
        </div>
      </section>

      <footer style="margin-top:14px;text-align:center;">
        <div class="small">
          © <span id="year"></span> <span id="footerBrand">Tap-Deck</span>
        </div>
      </footer>

    </section>
  </main>

<script>
const DEFAULT_THEME = "theme-01-neon-dark.css";
const DEFAULT_LOGO  = "/assets/logos/crestedcritters.png";
const BRAND_HOST    = "www.tap-deck.com";
const $ = id => document.getElementById(id);

function getParam(name){
  return new URLSearchParams(location.search).get(name) || "";
}

function normalizeUrl(u){
  const x = (u||"").trim();
  if(!x) return "";
  if(x.startsWith("http")) return x;
  return "https://" + x;
}

function normalizeTheme(v){
  const s = (v||"").trim();
  return s.replace(/^\/?themes\//i,"");
}

function hide(el){ if(el) el.classList.add("is-hidden"); }
function show(el){ if(el) el.classList.remove("is-hidden"); }

function setBtn(id,url){
  const el=$(id);
  if(!url){ hide(el); return; }
  show(el);
  el.href=url;
}

function applyLinksLayout(){
  const wrap=$("linksWrap");
  const btns=[...wrap.querySelectorAll(".btn")]
    .filter(b=>!b.classList.contains("is-hidden"));

  wrap.classList.remove("links--grid");
  btns.forEach(b=>{
    b.classList.remove("btn--last-full");
    b.classList.remove("btn--small");
  });

  if(btns.length>=5){
    btns.forEach(b=>b.classList.add("btn--small"));
  }

  if(btns.length>=4){
    wrap.classList.add("links--grid");
    if(btns.length%2===1){
      btns[btns.length-1].classList.add("btn--last-full");
    }
  }
}

async function fetchClient(slug){
  const url=`https://${BRAND_HOST}/data/clients/${slug}.json?v=${Date.now()}`;
  const res=await fetch(url,{cache:"no-store"});
  if(!res.ok) throw new Error("Profile not found");
  return await res.json();
}

async function main(){
  $("year").textContent=new Date().getFullYear();
  const slug=(location.pathname.replace(/^\/+|\/+$/g,"")||getParam("client")||"").toLowerCase();
  if(!slug){
    $("brand").textContent="No profile selected";
    hide($("linksWrap"));
    hide($("aboutSection"));
    hide($("actionsWrap"));
    hide($("contactSection"));
    return;
  }

  const client=await fetchClient(slug);

  $("brand").textContent=client.businessName||slug;
  $("footerBrand").textContent=client.businessName||"Tap-Deck";
  $("tagline").textContent=client.tagline||"";

  $("themeStylesheet").href="/themes/"+normalizeTheme(client.theme||DEFAULT_THEME);

  $("logoImg").src=client.logoPath||DEFAULT_LOGO;
  $("logoLink").href=normalizeUrl(client.links?.website)||"#";

  // ABOUT
  if(client.about){
    $("about").textContent=client.about;
    show($("aboutSection"));
  }else{
    hide($("aboutSection"));
  }

  // LINKS
  const links=client.links||{};
  setBtn("btnWebsite",normalizeUrl(links.website));
  setBtn("btnFacebook",normalizeUrl(links.facebook));
  setBtn("btnInstagram",normalizeUrl(links.instagram));
  setBtn("btnTikTok",normalizeUrl(links.tiktok));
  setBtn("btnLinkedIn",normalizeUrl(links.linkedin));
  setBtn("btnPayPal",normalizeUrl(links.paypal));
  setBtn("btnCashApp",normalizeUrl(links.cashapp));
  setBtn("btnVenmo",normalizeUrl(links.venmo));

  // ACTIONS (below about)
  const phone=client.contact?.phoneE164||"";
  const email=client.contact?.email||"";

  if(phone){
    $("btnCall").href="tel:"+phone;
    $("btnText").href="sms:"+phone;
    show($("btnCall"));
    show($("btnText"));
  }

  if(email){
    $("btnEmail").href="mailto:"+email;
    show($("btnEmail"));
  }

  if(!phone && !email){
    hide($("actionsWrap"));
  }

  // CONTACT
  $("contactName").textContent=client.contact?.name||"";
  if(phone){
    $("contactPhone").textContent=client.contact?.phoneDisplay||phone;
    $("contactPhone").href="tel:"+phone;
    show($("rowPhone"));
  }
  if(email){
    $("contactEmail").textContent=email;
    $("contactEmail").href="mailto:"+email;
    show($("rowEmail"));
  }

  applyLinksLayout();
}

main().catch(()=>{
  $("brand").textContent="Profile not found";
});
</script>
</body>
</html>